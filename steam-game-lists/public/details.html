<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Favorites</title>
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #1b2838;
            color: #c5c6c7;
            margin: 0;
            padding: 0;
        }

        h1 {
            text-align: center;
            color: #66c0f4;
            padding: 20px 0;
        }

        nav {
            background-color: #2a475e;
            padding: 10px 0;
        }

        nav ul {
            display: flex;
            justify-content: center;
            list-style: none;
            margin: 0;
            padding: 0;
        }

        nav ul li {
            margin: 0 15px;
        }

        nav ul a {
            text-decoration: none;
            color: #66c0f4;
            font-size: 1.2rem;
            transition: color 0.3s;
        }

        nav ul a:hover {
            color: #ffffff;
        }

        .swiper-container {
            width: 100%;
            height: auto;
            background-color: #1b2838;
            padding: 20px 0;
            border-radius: 10px;
        }

        .swiper-pagination-bullet {
            width: 16px; 
            height: 16px; 
            background-color: #66c0f4;
            opacity: 0.7;
        }

        .swiper-pagination-bullet-active {
            background-color: #ffffff;
        }

        .swiper-button-next, 
        .swiper-button-prev {
            color: #66c0f4; 
        }

        .game-card {
            background-color: #2a475e;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            width: 120px;
            transition: transform 0.3s, box-shadow 0.3s;
            text-decoration: none; 
            color: inherit; 

        }

        .game-card:hover {
            transform: translateY(-10px);
        }

        .game-card img.game-image {
            width: 80px; 
            height: 80px; 
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .game-card h3 {
            color: #66c0f4;
            font-size: 0.9rem;
            margin-bottom: 8px; 
        }

        .game-card p.playtime {
            color: #c5c6c7;
            font-size: 0.8rem;
        }

        .recommendation-section {
            text-align: center;
            margin: 20px 0;
        }

        .recommendation-section h2 {
            color: #66c0f4;
        }

        .recommendation-game img {
            width: 150px;
            border-radius: 8px;
        }

        .recommendation-game a {
            color: #66c0f4;
            font-size: 1rem;
            text-decoration: none;
        }

        .recommendation-game a:hover {
            color: #ffffff;
        }
    </style>
</head>
<body>

    <!-- Navigation Bar -->
    <nav>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="readme.html">ReadMe</a></li>
        </ul>
    </nav>

    <h1>Favorite Games</h1>

    <div class="swiper-container">
        <div class="swiper-wrapper"></div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
        <div class="swiper-pagination"></div>
    </div>

    <div class="recommendation-section">
        <h2>Your Favorite Genre: <span id="favoriteGenre">Loading...</span></h2>
        <h2>Recommended Game</h2>
        <div id="recommendedGame" class="recommendation-game">Loading recommendation...</div>
    </div>

    <script>
        const API_KEY = '412EBB6903BA8014ECC931C393E7014E';

        async function fetchUserFavoriteGames(steamId) {
            const url = `https://api.steampowered.com/IPlayerService/GetOwnedGames/v1/?key=${API_KEY}&steamid=${steamId}&include_appinfo=1&format=json`;
            const response = await fetch(url);
            const data = await response.json();
            return data.response?.games || [];
        }

        async function fetchGameDetails(appId) {
            const url = `https://store.steampowered.com/api/appdetails?appids=${appId}`;
            const response = await fetch(url);
            const data = await response.json();
            return data[appId]?.data?.genres?.map(genre => genre.description) || [];
        }

        async function determineFavoriteGenre(games) {
            const genreCount = {};
            const gameDetails = await Promise.all(games.slice(0, 5).map(game => fetchGameDetails(game.appid)));
            gameDetails.flat().forEach(genre => {
                genreCount[genre] = (genreCount[genre] || 0) + 1;
            });

            const favoriteGenre = Object.entries(genreCount).sort((a, b) => b[1] - a[1])[0]?.[0];
            document.getElementById('favoriteGenre').textContent = favoriteGenre || 'Unknown';
            return favoriteGenre;
        }

        async function recommendGame(ownedGames, genre) {
    try {
        const url = `https://store.steampowered.com/api/featuredcategories`;
        const response = await fetch(url);
        const data = await response.json();
        const featuredGames = data.top_sellers.items.map(item => ({
            appid: item.id,
            name: item.name,
            image: item.large_capsule_image
        }));

        // Fetch detailed genre info for each featured game
        const gameDetails = await Promise.all(
            featuredGames.map(async (game) => {
                try {
                    const url = `https://store.steampowered.com/api/appdetails?appids=${game.appid}`;
                    const response = await fetch(url);
                    const detailsData = await response.json();
                    const genres = detailsData[game.appid]?.data?.genres?.map(genre => genre.description) || [];
                    return { ...game, genres };
                } catch (error) {
                    console.error(`Error fetching details for ${game.name}:`, error);
                    return { ...game, genres: [] };
                }
            })
        );

        // Filter games 
        const unownedAppIds = ownedGames.map(game => game.appid);
        const genreMatchedGames = gameDetails.filter(game => 
            game.genres.some(g => g.toLowerCase() === genre.toLowerCase()) && 
            !unownedAppIds.includes(game.appid)
        );

        const recommendedGame = genreMatchedGames.length > 0 
            ? genreMatchedGames[Math.floor(Math.random() * genreMatchedGames.length)] 
            : null;

        const recommendationElement = document.getElementById('recommendedGame');
        
        if (recommendedGame) {
            recommendationElement.innerHTML = `
                <img src="${recommendedGame.image}" alt="${recommendedGame.name}" />
                <a href="https://store.steampowered.com/app/${recommendedGame.appid}" target="_blank">${recommendedGame.name}</a>
            `;
        } else {
            recommendationElement.textContent = 'No recommendations found';
        }
    } catch (error) {
        console.error('Error in recommendGame function:', error);
        const recommendationElement = document.getElementById('recommendedGame');
        recommendationElement.textContent = 'Error fetching recommendation';
    }
}


        function displayFavoriteGames(games) {
            const carousel = document.querySelector('.swiper-wrapper');
            const sortedGames = games.sort((a, b) => b.playtime_forever - a.playtime_forever).slice(0, 10);
            
            sortedGames.forEach(game => {
                const imgUrl = `https://media.steampowered.com/steamcommunity/public/images/apps/${game.appid}/${game.img_icon_url}.jpg`;
                carousel.innerHTML += `
                    <a class="swiper-slide game-card" href="https://store.steampowered.com/app/${game.appid}/">
                        <img src="${imgUrl}" alt="${game.name}" class="game-image"/>
                        <h3>${game.name}</h3>
                        <p>${Math.round(game.playtime_forever / 60)} hours played</p>
                    </a>`;
            });

            new Swiper('.swiper-container', { slidesPerView: 3, spaceBetween: 20, loop: true });
        }

        async function initializeFavoriteGames(steamId) {
            const games = await fetchUserFavoriteGames(steamId);
            if (games) {
                displayFavoriteGames(games);
                const favoriteGenre = await determineFavoriteGenre(games);
                if (favoriteGenre) recommendGame(games, favoriteGenre);
            }
        }

        initializeFavoriteGames('76561198322212663');
    </script>

</body>
</html>
